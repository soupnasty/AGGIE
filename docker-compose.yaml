# AGGIE Voice Assistant - Docker Compose
#
# Usage:
#   docker compose up          # Start daemon (foreground)
#   docker compose up -d       # Start daemon (background)
#   docker compose down        # Stop daemon
#   docker compose logs -f     # View logs
#
# Control (while running):
#   docker compose exec aggie aggie-ctl status
#   docker compose exec aggie aggie-ctl mute
#   docker compose exec aggie aggie-ctl cancel

services:
  aggie:
    build: .
    image: aggie:latest
    container_name: aggie
    restart: unless-stopped

    # Required for audio access
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - PULSE_SERVER=unix:/run/user/1000/pulse/native

    # Audio device access
    devices:
      - /dev/snd:/dev/snd

    # Mount PulseAudio socket for audio I/O
    volumes:
      # PulseAudio socket (adjust path if needed)
      - ${XDG_RUNTIME_DIR:-/run/user/1000}/pulse:/run/user/1000/pulse:ro
      # Persist model cache (avoids re-downloading)
      - aggie-cache:/home/aggie/.cache
      - aggie-models:/home/aggie/.local/share
      # Optional: custom config
      # - ./config/aggie.yaml.example:/home/aggie/.config/aggie/config.yaml:ro

    # Required for PulseAudio
    group_add:
      - audio

    # Use host network for simpler audio setup (alternative to port mapping)
    # Uncomment if you have audio issues:
    # network_mode: host

volumes:
  aggie-cache:
    name: aggie-cache
  aggie-models:
    name: aggie-models
